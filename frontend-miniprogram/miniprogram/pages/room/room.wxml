<!--room.wxml-->
<navigation-bar title="æˆ¿é—´" back="{{true}}" color="black" background="#FFF"></navigation-bar>

<view class="page-container">
  <!-- æˆå‘˜åˆ—è¡¨ - æ¨ªå‘æ»šåŠ¨ -->
  <view class="members-section">
    <view class="section-header">
      <view class="section-title">æˆ¿é—´æˆå‘˜</view>
      <view class="room-code-display" bindtap="copyRoomCode">
        <text class="room-code-label">æˆ¿é—´ID: {{roomCode}}</text>
        <text class="copy-icon">ğŸ“‹</text>
      </view>
    </view>
    <scroll-view class="members-scroll" scroll-x="true" enable-flex="true">
      <view class="members-list">
        <view class="member-item" wx:for="{{members}}" wx:key="id" bindtap="onMemberTap" data-member="{{item}}">
          <image class="member-avatar" src="{{item.avatarUrl}}" mode="aspectFill"></image>
          <view class="member-name">{{item.username}}</view>
          <view class="member-balance {{item.balance >= 0 ? 'positive' : 'negative'}}">
            {{item.formattedBalance}}
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- æˆ¿é—´æ—¥å¿— - å æ»¡å‰©ä½™åŒºåŸŸ -->
  <view class="activities-section">
    <view class="section-title">æˆ¿é—´æ—¥å¿—</view>
    <scroll-view class="activities-scroll" scroll-y="true">
      <view class="activities-list">
        <view class="activity-item" wx:for="{{activities}}" wx:key="index">
          <view class="activity-time">{{item.formattedTime}}</view>
          <view class="activity-message">{{item.message}}</view>
        </view>
        <view class="empty-tip" wx:if="{{activities.length === 0}}">æš‚æ— æ—¥å¿—</view>
      </view>
    </scroll-view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="actions">
    <button class="btn-action btn-share" open-type="share">
      <text class="btn-icon">ğŸ“¤</text>
      <text class="btn-text">é‚€è¯·å¥½å‹</text>
    </button>
    <button class="btn-action btn-leave" bindtap="leaveRoom">
      <text class="btn-icon">ğŸšª</text>
      <text class="btn-text">ç¦»å¼€æˆ¿é—´</text>
    </button>
    <button class="btn-action btn-close" bindtap="closeRoom" wx:if="{{isOwner}}">
      <text class="btn-icon">ğŸ”’</text>
      <text class="btn-text">ç»“æŸæˆ¿é—´</text>
    </button>
  </view>

  <!-- è½¬è´¦å¯¹è¯æ¡† -->
  <t-dialog
    visible="{{showTransactionDialog}}"
    title="å‘ {{targetMember.username}} è½¬è´¦"
    bind:confirm="onTransactionConfirm"
    bind:cancel="onTransactionCancel"
    confirm-btn="ç¡®è®¤è½¬è´¦"
    cancel-btn="å–æ¶ˆ"
    async-close="{{true}}"
  >
    <view slot="content" class="transaction-dialog-content">
      <view class="transaction-target">
        <image class="transaction-target-avatar" src="{{targetMember.avatarUrl}}" mode="aspectFill"></image>
        <text class="transaction-target-name">{{targetMember.username}}</text>
      </view>
      <view class="transaction-form">
        <view class="transaction-form-item">
          <text class="transaction-label">è½¬è´¦é‡‘é¢ï¼ˆå…ƒï¼‰</text>
          <input
            class="transaction-input"
            type="digit"
            value="{{transactionAmount}}"
            placeholder="è¯·è¾“å…¥è½¬è´¦é‡‘é¢"
            bind:input="onTransactionAmountInput"
            maxlength="10"
          />
        </view>
        <view class="transaction-form-item">
          <text class="transaction-label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</text>
          <input
            class="transaction-input"
            value="{{transactionDescription}}"
            placeholder="è¯·è¾“å…¥å¤‡æ³¨"
            bind:input="onTransactionDescriptionInput"
            maxlength="50"
          />
        </view>
      </view>
    </view>
  </t-dialog>
</view>

