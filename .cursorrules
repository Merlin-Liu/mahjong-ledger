{
  "version": 1,
  "rules": [
    {
      "name": "Global WeChat Mini Program Context",
      "priority": 100,
      "patterns": ["**/*"],
      "instruction": [
        "你正在维护一个【微信小程序】项目，而不是 H5 或普通 Web。",
        "前端运行环境是微信小程序，不能使用 window / document / DOM API / 浏览器插件 等，仅能使用微信小程序提供的 wx.* 能力。",
        "如果对框架特性有疑问，默认使用【原生小程序】思路（WXML + WXSS + JS/TS + JSON），不要引入 React/Vue 等额外框架，除非代码里已经在用。",
        "尽量遵守项目中已有的代码风格、目录结构和命名方式。优先阅读同目录下已有文件再进行修改或新增。"
      ]
    },

    {
      "name": "Code Style & Language",
      "priority": 90,
      "patterns": [
        "**/*.js",
        "**/*.ts",
        "**/*.wxs"
      ],
      "instruction": [
        "优先使用 TypeScript。如果当前文件是 JS，但新增文件时可以选择，用 TS（.ts）代替 JS（.js）。",
        "保持原有的代码风格：缩进、分号、有无逗号等以项目现有文件为准。如果存在 ESLint / Prettier 配置，则按其规则编写代码。",
        "在小程序中使用模块化（import / export），避免在全局挂载变量。",
        "函数尽量短小，单一职责。公共逻辑抽离到 utils / hooks / helpers 等目录（如果已存在）。"
      ]
    },

    {
      "name": "Mini Program Page Files",
      "priority": 80,
      "patterns": [
        "miniprogram/pages/**/*.js",
        "miniprogram/pages/**/*.ts",
        "miniprogram/pages/**/*.wxml",
        "miniprogram/pages/**/*.wxss"
      ],
      "instruction": [
        "页面文件遵循微信小程序的四件套结构：.json / .wxml / .wxss / .js(.ts)。修改其中一个文件时，注意是否需要同步更新其它三个文件。",
        "当新增页面时：",
        "1. 在 app.json (或分包 xxx.json) 中注册页面路径；",
        "2. 为页面创建同名目录和四个文件：index.json / index.wxml / index.wxss / index.ts；",
        "3. 在 Page({...}) 中初始化 data，事件命名为 onXxx，例如 onLoad、onShow、onTapItem 等。",
        "WXML 编写规范：",
        "- 使用 data 绑定，不在 WXML 中编写复杂逻辑；",
        "- 使用 wx:for / wx:if 时，保证 key 唯一，避免嵌套过深；",
        "- 尽量通过 class 控制样式，不滥用 inline style；",
        "WXSS 编写规范：",
        "- 避免冗余样式，复用公共样式（如 common.wxss 或 components 样式）；",
        "- 使用 rpx 作为主要单位，保证多机型适配；",
        "- 命名可以参考 BEM，如 page-header__title。"
      ]
    },

    {
      "name": "Mini Program Components",
      "priority": 80,
      "patterns": [
        "miniprogram/components/**/*.js",
        "miniprogram/components/**/*.ts",
        "miniprogram/components/**/*.wxml",
        "miniprogram/components/**/*.wxss"
      ],
      "instruction": [
        "自定义组件使用 Component({...}) 进行声明，合理区分 properties / data / methods。",
        "组件对外暴露最少必要的属性和事件，避免将页面逻辑塞到组件内部。",
        "新增组件时：",
        "- 放在 miniprogram/components/xxx 目录下；",
        "- 创建同名四件套文件；",
        "- 在使用该组件的页面/组件的 json 中进行 usingComponents 声明。",
        "尽量做『傻组件』：只关心展示和交互，把业务决策留给页面层。"
      ]
    },

    {
      "name": "Network Request Layer",
      "priority": 70,
      "patterns": [
        "miniprogram/utils/request.*",
        "miniprogram/api/**/*.ts",
        "miniprogram/api/**/*.js"
      ],
      "instruction": [
        "所有网络请求统一通过封装的 request 工具（如 miniprogram/utils/request.ts）调用，不要在页面直接使用 wx.request。",
        "如果要新增接口：",
        "1. 在 api 目录下为该业务模块新增或补充对应的 api 文件，例如 api/score.ts；",
        "2. 使用统一的 request 封装（带上 baseURL、拦截器、错误处理、登录态处理等）；",
        "3. 导出语义化的函数名，如 fetchRoomList、createRoom、submitScore，而不是直接叫 request。",
        "错误处理：",
        "- 统一在 request 层处理通用错误（网络错误、未登录等）；",
        "- 业务错误（例如余额不足、权限不足）在调用处根据返回码单独处理。"
      ]
    },

    {
      "name": "Config & Constants",
      "priority": 60,
      "patterns": [
        "miniprogram/config/**/*.ts",
        "miniprogram/config/**/*.js",
        "miniprogram/constants/**/*.ts",
        "miniprogram/constants/**/*.js"
      ],
      "instruction": [
        "把可配置项（API 路径、环境变量 key、业务常量、枚举等）放在 config 或 constants 目录，不要散落在页面里写死。",
        "新增常量时优先检查是否已存在相似常量，避免重复定义。",
        "命名清晰，例如 ENV, BASE_URL, STORAGE_KEYS, ROUTE_PATHS 等。"
      ]
    },

    {
      "name": "Cloud Functions (微信云开发可选)",
      "priority": 60,
      "patterns": [
        "cloudfunctions/**/*.js",
        "cloudfunctions/**/*.ts"
      ],
      "instruction": [
        "云函数运行在 Node.js 环境，不可以直接访问小程序端的 wx API。",
        "云函数应使用 async/await，处理好异常并返回结构化的结果，例如 { code, data, message }。",
        "尽量避免在云函数里写死敏感信息，使用环境变量或配置文件管理。",
        "云函数只做单一职责，例如 createRoom、joinRoom、syncScore，不要做『大而全』的 God function。"
      ]
    },

    {
      "name": "State & Data Management in Pages",
      "priority": 55,
      "patterns": [
        "miniprogram/pages/**/*.js",
        "miniprogram/pages/**/*.ts"
      ],
      "instruction": [
        "页面状态放在 this.data 中，通过 this.setData 更新，不要直接修改 this.data.xxx。",
        "避免频繁、大量的 setData 调用，尽量合并更新，减少数据传输。",
        "事件处理函数命名以 on 开头，如 onInputChange、onConfirm、onTapCreateRoom。",
        "跨页面共享数据时：",
        "- 优先使用全局 app 实例 / storage（wx.setStorageSync / wx.getStorageSync）；",
        "- 或者使用微信云开发数据库 / 后端接口做持久化；",
        "- 不要在多个页面之间互相 require 对方文件。"
      ]
    },

    {
      "name": "Testing & Debugging (If Present)",
      "priority": 40,
      "patterns": [
        "tests/**/*.ts",
        "tests/**/*.js",
        "**/*.spec.ts",
        "**/*.test.ts"
      ],
      "instruction": [
        "如果项目有单元测试或集成测试，新增功能时尽量补齐对应测试用例。",
        "优先模仿已有测试文件的结构和断言写法。",
        "避免在测试中依赖真实网络请求，优先通过 mock 模块或假数据。"
      ]
    },

    {
      "name": "Refactor & Large Changes",
      "priority": 30,
      "patterns": ["**/*"],
      "instruction": [
        "在进行重构或大规模改动时，优先保持对外行为不变（API、页面路由、数据结构）。",
        "先阅读相关页面或模块的所有文件（wxml / wxss / js / json / 组件 / api / 云函数）再改动。",
        "分步骤、小提交进行重构：先抽取工具函数，再替换调用，最后删除旧实现。",
        "对已有逻辑保持谨慎，如果不确定业务含义，倾向于少改，保守修改。"
      ]
    }
  ]
}
